clear all;
load('data90.mat');
n=length(C);
folder = 'Results';

A = double.empty(0,n);
b = double.empty(0,1);
totaltimes=1;
for m=[1,5,10,20]
    %% create data file
    baseFileName = strcat('data',int2str(n),'_m=',int2str(m),'.xlsx');
    fullFileNameexcel = fullfile(folder, baseFileName);
    if exist(fullFileNameexcel, 'file')==2
      delete(fullFileNameexcel);
    end
    % we use the same A1 for each m
    A1 = randi([1,10],m,n);
    for repeattimes=1:totaltimes
        exceloutput=[];
        for s=10:80
            sprintf("In the current iteration, n=%d, s=%d, m=%d", n, s, m)
            %% initialize the MESP instance for each (m,s) pair
            [xind, ~] = heur(C,s,A,b);
            x=zeros(n,1);
            x(xind)=1;
            b1 = A1*x-ones(m,1);
            Prob = MESP(C,A1,b1);
            %% lower bound
            lb = Prob.obtain_lb(s);

            x0=s/n*ones(n,1);
            %% Linx data
            [optgamma,info]= Prob.BFGS_Linx_gamma(s);
            [~,~,info_Linx_scalar] = Prob.Knitro_Linx(x0,s,sqrt(optgamma)*ones(n,1));
            
            [optGamma,info]= Prob.BFGS_Linx_Gamma(s,sqrt(optgamma)*ones(n,1));
            [~,~,info_Linx] = Prob.Knitro_Linx(x0,s,optGamma);

            %% DDFact data
            [~,~,info_DDFact_scalar] = Prob.Knitro_DDFact(x0,s,ones(n,1));
            [optGamma,info]= Prob.BFGS_DDFact_Gamma(s,ones(n,1));
            [~,~,info_DDFact] = Prob.Knitro_DDFact(x0,s,optGamma);
            
            %% DDFact comp data
            [~,~,info_DDFact_comp_scalar] = Prob.Knitro_DDFact_comp(x0,s,ones(n,1));
            [optGamma,info]= Prob.BFGS_DDFact_comp_Gamma(s,ones(n,1));
            [~,~,info_DDFact_comp] = Prob.Knitro_DDFact_comp(x0,s,optGamma);

            exceloutput(end+1,:)=[n, s, lb,...
                info_Linx_scalar.exitflag, info_Linx.exitflag,... 
                info_DDFact_scalar.exitflag, info_DDFact.exitflag,...
                info_DDFact_comp_scalar.exitflag, info_DDFact_comp.exitflag,...
                info_Linx_scalar.dualbound, info_Linx.dualbound,... 
                info_DDFact_scalar.dualbound, info_DDFact.dualbound,...
                info_DDFact_comp_scalar.dualbound, info_DDFact_comp.dualbound,...
                info_Linx_scalar.integrality_gap, info_Linx.integrality_gap,... 
                info_DDFact_scalar.integrality_gap, info_DDFact.integrality_gap,...
                info_DDFact_comp_scalar.integrality_gap, info_DDFact_comp.integrality_gap,...
                info_Linx_scalar.continuous_dualgap, info_Linx.continuous_dualgap,... 
                info_DDFact_scalar.continuous_dualgap, info_DDFact.continuous_dualgap,...
                info_DDFact_comp_scalar.continuous_dualgap, info_DDFact_comp.continuous_dualgap,...
                info_Linx_scalar.fixnum_to0, info_Linx.fixnum_to0,... 
                info_DDFact_scalar.fixnum_to0, info_DDFact.fixnum_to0,...
                info_DDFact_comp_scalar.fixnum_to0, info_DDFact_comp.fixnum_to0,...
                info_Linx_scalar.fixnum_to1, info_Linx.fixnum_to1,... 
                info_DDFact_scalar.fixnum_to1, info_DDFact.fixnum_to1,...
                info_DDFact_comp_scalar.fixnum_to1, info_DDFact_comp.fixnum_to1,...
                info_Linx_scalar.fixnum, info_Linx.fixnum,... 
                info_DDFact_scalar.fixnum, info_DDFact.fixnum,...
                info_DDFact_comp_scalar.fixnum, info_DDFact_comp.fixnum,...
                info_Linx_scalar.time, info_Linx.time,... 
                info_DDFact_scalar.time, info_DDFact.time,...
                info_DDFact_comp_scalar.time, info_DDFact_comp.time,...
                info_Linx_scalar.cputime, info_Linx.cputime,... 
                info_DDFact_scalar.cputime, info_DDFact.cputime,...
                info_DDFact_comp_scalar.cputime, info_DDFact_comp.cputime,...
                info_Linx_scalar.funcCount, info_Linx.funcCount,... 
                info_DDFact_scalar.funcCount, info_DDFact.funcCount,...
                info_DDFact_comp_scalar.funcCount, info_DDFact_comp.funcCount];
        end
        if repeattimes==1
            exceloutputall=exceloutput;
        else
            exceloutputall=exceloutputall+exceloutput;
        end
    end
    exceloutputall=exceloutputall./totaltimes;

    title=["n", "s","lb",...
            "info_Linx_scalar.exitflag", "info_Linx.exitflag",... 
            "info_DDFact_scalar.exitflag", "info_DDFact.exitflag",...
            "info_DDFact_comp_scalar.exitflag", "info_DDFact_comp.exitflag",...
            "info_Linx_scalar.dualbound", "info_Linx.dualbound",... 
            "info_DDFact_scalar.dualbound", "info_DDFact.dualbound",...
            "info_DDFact_comp_scalar.dualbound", "info_DDFact_comp.dualbound",...
            "info_Linx_scalar.integrality_gap", "info_Linx.integrality_gap",... 
            "info_DDFact_scalar.integrality_gap", "info_DDFact.integrality_gap",...
            "info_DDFact_comp_scalar.integrality_gap", "info_DDFact_comp.integrality_gap",...
            "info_Linx_scalar.continuous_dualgap", "info_Linx.continuous_dualgap",... 
            "info_DDFact_scalar.continuous_dualgap", "info_DDFact.continuous_dualgap",...
            "info_DDFact_comp_scalar.continuous_dualgap", "info_DDFact_comp.continuous_dualgap",...
            "info_Linx_scalar.fixnum_to0", "info_Linx.fixnum_to0",... 
            "info_DDFact_scalar.fixnum_to0", "info_DDFact.fixnum_to0",...
            "info_DDFact_comp_scalar.fixnum_to0", "info_DDFact_comp.fixnum_to0",...
            "info_Linx_scalar.fixnum_to1", "info_Linx.fixnum_to1",... 
            "info_DDFact_scalar.fixnum_to1", "info_DDFact.fixnum_to1",...
            "info_DDFact_comp_scalar.fixnum_to1", "info_DDFact_comp.fixnum_to1",...
            "info_Linx_scalar.fixnum", "info_Linx.fixnum",... 
            "info_DDFact_scalar.fixnum", "info_DDFact.fixnum",...
            "info_DDFact_comp_scalar.fixnum", "info_DDFact_comp.fixnum",...
            "info_Linx_scalar.time", "info_Linx.time",... 
            "info_DDFact_scalar.time", "info_DDFact.time",...
            "info_DDFact_comp_scalar.time", "info_DDFact_comp.time",...
            "info_Linx_scalar.cputime", "info_Linx.cputime",... 
            "info_DDFact_scalar.cputime", "info_DDFact.cputime",...
            "info_DDFact_comp_scalar.cputime", "info_DDFact_comp.cputime",...
            "info_Linx_scalar.funcCount", "info_Linx.funcCount",... 
            "info_DDFact_scalar.funcCount", "info_DDFact.funcCount",...
            "info_DDFact_comp_scalar.funcCount", "info_DDFact_comp.funcCount"];
    xlswrite(fullFileNameexcel ,title,1,'A1');
    xlswrite(fullFileNameexcel ,exceloutputall,1,'A2');
end


